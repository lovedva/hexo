[TOC]
## PIDアルゴリズムによるフィードバック制御
### PID制御のプロセス
![](assets/1/20181013-700d156b.png)  

Sv：設定された目標値  
Pv: 制御対象の現在値

### PIDアルゴリズム
#### 1.MCU起動する以来センサーが採取した全部のサンプリングデータの行列
** X1, X2, X3... Xk-1, Xk **  

#### 2.現在のデータと目標値の偏差を計算

** 現在の偏差：Ek=Sv-Xk **  
  Ek<0の場合：目標に未着.  

  Ek=0の場合：目標と一致.  

  Ek>0の場合：目標を超えている.  

  現在の偏差を操作量にすると，出力は  
** POUT=Kp・Ek+OUT0 (比例出力)**   
ここで，Kpは定数で比例ゲインと呼ばれる。Kpは現在の偏差を増幅/収縮させるための定数。    
OUT0はEk=0の時，出力を続けるの定数。  
#### 3．過去全部のサンプリング偏差値を行列にする
** E1, E2, E3... Ek-1, Ek**  
これを全部足し算すると  
**過去全部の偏差の和：Sk=E1+E2+E3+...+Ek-1,Ek**  
Sk<0の場合：今まで多くの時間は目標に未着  

Sk=0の場合：今までは目標と一致。  

Sk>0の場合：今まで多くの時間は目標を超えている  

Skを出力にすると  
**IOUT=Kp・Sk+OUT0 (積分出力)**   

#### 4.現在と前の二つの偏差を引き算
**偏差値の差：Dk=Ek-Ek-1**  
Dk<0の場合：偏差の変化率は小さくなている

Dk=0の場合：偏差は変わっていない

Dk>0の場合：偏差の変化率が大きくなる

Dkを出力にすると  
**DOUT=Kp・Dp+OUT0 (微分出力)**  

#### 5.まとめとPID出力
比例アルゴリズムP：現在の偏差だけを基づいて，操作量を出力。  
積分アルゴリズムI：過去全部の偏差を基づいて，操作量を出力。  
微分アルゴリズムD：誤差の変化率を基づいて，操作量を出力。  
これ全部まとめて出力にすると  
**PIDout=Kp・(Ek+Sk+Dk)+OUT0**  PID出力になる。  

### MCUを基づいてPIDのアルゴリズム
#### 1．Skの公式
![](assets/1/20181013-dd243111.png)  
T:サンプリングの周期  
Ti：積分時間（過去から現在まで時間）
#### 2.Dkの公式
![](assets/1/20181013-ca7297bd.png)  
Td：微分時間
#### 3．まとめてPIDの公式
![](assets/1/20181013-02b33059.png)  

### パラメーターの調整
PID制御の各パラメータの値（Kp、Ti、Td）は設計値なので、制御対象とは独立に自由に与えることができ、要求を満たす最適な値を決定する必要がある。  
しかし、一般的な制御対象に対して、最適なゲイン値を与える代数的な方法は存在せず、実際の調整は、数値シミュレーションを行ったり、実際の対象物に調整器を繋いで試行錯誤的に最適値を得ている。

### 参考文献
https://ja.wikipedia.org/wiki/PID%E5%88%B6%E5%BE%A1
